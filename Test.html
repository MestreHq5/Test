<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV to Chart</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        .chart-container {
            width: 800px;
            height: 600px;
            margin: auto;
        }
    </style>
</head>
<body>
    <input type="file" id="csv-file" accept=".csv">
    <div class="chart-container">
        <canvas id="myChart"></canvas>
    </div>
    <script>
        document.getElementById('csv-file').addEventListener('change', handleFileSelect, false);

        function handleFileSelect(event) {
            const reader = new FileReader();
            reader.readAsText(event.target.files[0]);
            reader.onload = function(event) {
                const csv = event.target.result;
                const data = d3.csvParse(csv);
                let xVar = prompt('Enter the name of the X-axis variable (column name):');
                let yVar = prompt('Enter the name of the Y-axis variable (column name):');
                let xData = data.map(d => d[xVar]);
                let yData = data.map(d => d[yVar]);

                if (typeof xData[0] === 'string' && typeof yData[0] === 'string') {
                    // Draw a bar chart
                    let trace = {
                        x: yData,
                        y: xData,
                        type: 'bar'
                    };
                    let layout = {
                        title: yVar + ' vs ' + xVar,
                        xaxis: {
                            title: yVar
                        },
                        yaxis: {
                            title: xVar
                        }
                    };
                    Plotly.newPlot('myChart', [trace], layout);
                } else if (typeof xData[0] === 'number' && typeof yData[0] === 'number') {
                    // Draw a scatter plot
                    let trace = {
                        x: xData,
                        y: yData,
                        mode: 'markers',
                        type: 'scatter'
                    };
                    let layout = {
                        title: yVar + ' vs ' + xVar,
                        xaxis: {
                            title: xVar
                        },
                        yaxis: {
                            title: yVar
                        }
                    };
                    Plotly.newPlot('myChart', [trace], layout);
                } else {
                    // Draw a pie chart
                    let labels = [...new Set(xData)];
                    let values = labels.map(label => xData.filter(x => x === label).length);
                    let trace = {
                        values: values,
                        labels: labels,
                        type: 'pie'
                    };
                    let layout = {
                        title: xVar,
                    };
                    Plotly.newPlot('myChart', [trace], layout);
                }
            };
        }
    </script>
</body>
</html>
